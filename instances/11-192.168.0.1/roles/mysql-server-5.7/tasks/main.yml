---
- name: Install MySQL packages
  apt: pkg={{ item }} state=installed
  when: ansible_os_family == 'Debian'
  with_items:
  - python-mysqldb
  - mysql-server-5.7
- name: mysql | Update root password for all root accounts
  mysql_user: name=root host={{ item }} check_implicit_admin=yes password={{ mysql.root_password }} login_user=root login_password={{ mysql.root_password }} update_password=on_create
  with_items:
  - 127.0.0.1
  - ::1
  - localhost

- name: Deletes anonymous MySQL server user for localhost
  mysql_user: user="" state="absent" login_password="{{ mysql.root_password }}" login_user="root"

- name: mysql | Create databases
  mysql_db: name={{ mysql.database }} state=present login_user=root login_password={{ mysql.root_password }}

- name: mysql | Create users
  mysql_user: name={{ mysql.user }} password={{ mysql.password }} priv={{ mysql.database }}.*:ALL state=present login_user=root login_password={{ mysql.root_password }}

- name: Removes the MySQL test database
  mysql_db: db=test state=absent login_password="{{ mysql.root_password }}" login_user=root
